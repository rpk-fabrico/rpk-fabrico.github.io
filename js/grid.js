var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,a){var d=this,c=arguments,b=function(){e.type="debouncedresize";$event.dispatch.apply(d,c)};if(resizeTimeout){clearTimeout(resizeTimeout)}a?b():resizeTimeout=setTimeout(b,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(h){var e=this,j=$.isFunction($.Deferred)?$.Deferred():0,i=$.isFunction(j.notify),b=e.find("img").add(e.filter("img")),c=[],g=[],d=[];if($.isPlainObject(h)){$.each(h,function(k,l){if(k==="callback"){h=l}else{if(j){j[k](l)}}})}function f(){var k=$(g),l=$(d);if(j){if(d.length){j.reject(b,k,l)}else{j.resolve(b)}}if($.isFunction(h)){h.call(e,b,k,l)}}function a(k,l){if(k.src===BLANK||$.inArray(k,c)!==-1){return}c.push(k);if(l){d.push(k)}else{g.push(k)}$.data(k,"imagesLoaded",{isBroken:l,src:k.src});if(i){j.notifyWith($(k),[l,b,$(g),$(d)])}if(b.length===c.length){setTimeout(f);b.unbind(".imagesLoaded")}}if(!b.length){f()}else{b.bind("load.imagesLoaded error.imagesLoaded",function(k){a(k.target,k.type==="error")}).each(function(k,m){var n=m.src;var l=$.data(m,"imagesLoaded");if(l&&l.src===n){a(m,l.isBroken);return}if(m.complete&&m.naturalWidth!==undefined){a(m,m.naturalWidth===0||m.naturalHeight===0);return}if(m.readyState||m.complete){m.src=BLANK;m.src=n}})}return j?j.promise(e):e};var Grid=(function(){var f=$("#og-grid"),e=f.children("li"),p=-1,m=-1,v=0,j=10,o=$(window),c,r=$("html, body"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},g=s[Modernizr.prefixed("transition")],l=Modernizr.csstransitions,u={minHeight:500,speed:350,easing:"ease"};function t(w){u=$.extend(true,{},u,w);f.imagesLoaded(function(){k(true);b();i()})}function n(w){e=e.add(w);w.each(function(){var x=$(this);x.data({offsetTop:x.offset().top,height:x.height()})});h(w)}function k(w){e.each(function(){var x=$(this);x.data("offsetTop",x.offset().top);if(w){x.data("height",x.height())}})}function i(){h(e);o.on("debouncedresize",function(){v=0;m=-1;k();b();var w=$.data(this,"preview");if(typeof w!="undefined"){q()}})}function h(w){w.on("click","span.og-close",function(){q();return false}).children("a").on("click",function(y){var x=$(this).parent();p===x.index()?q():a(x);return false})}function b(){c={width:o.width(),height:o.height()}}function a(x){var y=$.data(this,"preview"),w=x.data("offsetTop");v=0;if(typeof y!="undefined"){if(m!==w){if(w>m){v=y.height}q()}else{y.update(x);return false}}m=w;y=$.data(this,"preview",new d(x));y.open()}function q(){p=-1;var w=$.data(this,"preview");w.close();$.removeData(this,"preview")}function d(w){this.$item=w;this.expandedIdx=this.$item.index();this.create();this.update()}d.prototype={create:function(){this.$title=$("<h3></h3>");this.$description=$("<p></p>");this.$href=$('<a href="#">Visit website</a>');this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href);this.$loading=$('<div class="og-loading"></div>');this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading);this.$closePreview=$('<span class="og-close"></span>');this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details);this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner);this.$item.append(this.getEl());if(l){this.setTransition()}},update:function(x){if(x){this.$item=x}if(p!==-1){var A=e.eq(p);A.removeClass("og-expanded");this.$item.addClass("og-expanded");this.positionPreview()}p=this.$item.index();var z=this.$item.children("a"),y={href:z.attr("href"),largesrc:z.data("largesrc"),title:z.data("title"),description:z.data("description")};this.$title.html(y.title);this.$description.html(y.description);this.$href.attr("href",y.href);var w=this;if(typeof w.$largeImg!="undefined"){w.$largeImg.remove()}if(w.$fullimage.is(":visible")){this.$loading.show();$("<img/>").load(function(){var B=$(this);if(B.attr("src")===w.$item.children("a").data("largesrc")){w.$loading.hide();w.$fullimage.find("img").remove();w.$largeImg=B.fadeIn(350);w.$fullimage.append(w.$largeImg)}}).attr("src",y.largesrc)}},open:function(){setTimeout($.proxy(function(){this.setHeights();this.positionPreview()},this),25)},close:function(){var w=this,x=function(){if(l){$(this).off(g)}w.$item.removeClass("og-expanded");w.$previewEl.remove()};setTimeout($.proxy(function(){if(typeof this.$largeImg!=="undefined"){this.$largeImg.fadeOut("fast")}this.$previewEl.css("height",0);var y=e.eq(this.expandedIdx);y.css("height",y.data("height")).on(g,x);if(!l){x.call()}},this),25);return false},calcHeight:function(){var x=c.height-this.$item.data("height")-j,w=c.height;if(x<u.minHeight){x=u.minHeight;w=u.minHeight+this.$item.data("height")+j}this.height=x;this.itemHeight=w},setHeights:function(){var w=this,x=function(){if(l){w.$item.off(g)}w.$item.addClass("og-expanded")};this.calcHeight();this.$previewEl.css("height",this.height);this.$item.css("height",this.itemHeight).on(g,x);if(!l){x.call()}},positionPreview:function(){var x=this.$item.data("offsetTop"),w=this.$previewEl.offset().top-v,y=this.height+this.$item.data("height")+j<=c.height?x:this.height<c.height?w-(c.height-this.height):w;r.animate({scrollTop:y},u.speed)},setTransition:function(){this.$previewEl.css("transition","height "+u.speed+"ms "+u.easing);this.$item.css("transition","height "+u.speed+"ms "+u.easing)},getEl:function(){return this.$previewEl}};return{init:t,addItems:n}})();